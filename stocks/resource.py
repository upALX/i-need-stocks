from django.http import JsonResponse, HttpRequest, HttpResponse
from django.views import View
from django.utils.decorators import method_decorator
from django.views.decorators.http import require_http_methods
import requests
from .controller import StockController


@method_decorator(require_http_methods(["GET"]), name='dispatch')
class StockResource(View):

    def __init__(self) -> None:
        self.stock_controller = StockController()

    
    def get_health_check_resource(self, request: HttpRequest):
        stock_code = 'IBM'
        stock_key = 'b249bf9d-7fad-4154-bc8f-882ec8a86369'
        stock_data = {'Meta Data': {'1. Information': 'Intraday (5min) open, high, low, close prices and volume', '2. Symbol': 'IBM', '3. Last Refreshed': '2024-02-26 19:55:00', '4. Interval': '5min', '5. Output Size': 'Compact', '6. Time Zone': 'US/Eastern'}, 'Time Series (5min)': {'2024-02-26 19:55:00': {'1. open': '184.0500', '2. high': '184.1500', '3. low': '184.0000', '4. close': '184.0000', '5. volume': '151'}, '2024-02-26 19:50:00': {'1. open': '184.2000', '2. high': '184.2000', '3. low': '184.2000', '4. close': '184.2000', '5. volume': '1'}, '2024-02-26 19:35:00': {'1. open': '184.0000', '2. high': '184.0000', '3. low': '184.0000', '4. close': '184.0000', '5. volume': '1'}, '2024-02-26 19:30:00': {'1. open': '184.1300', '2. high': '184.2000', '3. low': '184.0000', '4. close': '184.2000', '5. volume': '224'}, '2024-02-26 19:25:00': {'1. open': '184.1300', '2. high': '184.1300', '3. low': '184.1300', '4. close': '184.1300', '5. volume': '1'}, '2024-02-26 19:15:00': {'1. open': '184.0000', '2. high': '184.0000', '3. low': '184.0000', '4. close': '184.0000', '5. volume': '75'}, '2024-02-26 19:10:00': {'1. open': '184.1200', '2. high': '184.1200', '3. low': '184.0000', '4. close': '184.0000', '5. volume': '6'}, '2024-02-26 19:05:00': {'1. open': '184.1300', '2. high': '184.1300', '3. low': '184.1300', '4. close': '184.1300', '5. volume': '8'}, '2024-02-26 19:00:00': {'1. open': '184.1300', '2. high': '184.1300', '3. low': '184.1300', '4. close': '184.1300', '5. volume': '1073836'}, '2024-02-26 18:40:00': {'1. open': '184.2000', '2. high': '184.2000', '3. low': '184.1500', '4. close': '184.1500', '5. volume': '26'}, '2024-02-26 18:30:00': {'1. open': '184.1300', '2. high': '184.1600', '3. low': '184.1300', '4. close': '184.1600', '5. volume': '1073846'}, '2024-02-26 18:25:00': {'1. open': '184.1000', '2. high': '184.1300', '3. low': '184.1000', '4. close': '184.1300', '5. volume': '29'}, '2024-02-26 18:20:00': {'1. open': '184.1000', '2. high': '184.1000', '3. low': '184.0900', '4. close': '184.0900', '5. volume': '12'}, '2024-02-26 18:15:00': {'1. open': '184.0000', '2. high': '184.0000', '3. low': '184.0000', '4. close': '184.0000', '5. volume': '172'}, '2024-02-26 18:10:00': {'1. open': '184.0000', '2. high': '184.0000', '3. low': '184.0000', '4. close': '184.0000', '5. volume': '11'}, '2024-02-26 18:00:00': {'1. open': '184.1000', '2. high': '184.1900', '3. low': '184.0000', '4. close': '184.1900', '5. volume': '102'}, '2024-02-26 17:55:00': {'1. open': '184.0000', '2. high': '184.0000', '3. low': '184.0000', '4. close': '184.0000', '5. volume': '1'}, '2024-02-26 17:50:00': {'1. open': '184.2500', '2. high': '184.2500', '3. low': '184.2500', '4. close': '184.2500', '5. volume': '15'}, '2024-02-26 17:45:00': {'1. open': '184.4000', '2. high': '184.4000', '3. low': '184.4000', '4. close': '184.4000', '5. volume': '1'}, '2024-02-26 17:40:00': {'1. open': '184.4000', '2. high': '184.4000', '3. low': '184.4000', '4. close': '184.4000', '5. volume': '51'}, '2024-02-26 17:35:00': {'1. open': '184.0500', '2. high': '184.0500', '3. low': '184.0000', '4. close': '184.0000', '5. volume': '55'}, '2024-02-26 17:30:00': {'1. open': '184.1300', '2. high': '184.1300', '3. low': '184.0100', '4. close': '184.0100', '5. volume': '63'}, '2024-02-26 17:25:00': {'1. open': '184.1300', '2. high': '184.1300', '3. low': '184.1300', '4. close': '184.1300', '5. volume': '4'}, '2024-02-26 17:15:00': {'1. open': '184.2000', '2. high': '184.2000', '3. low': '184.1900', '4. close': '184.1900', '5. volume': '14'}, '2024-02-26 17:10:00': {'1. open': '184.1000', '2. high': '184.1000', '3. low': '184.0500', '4. close': '184.0500', '5. volume': '2'}, '2024-02-26 17:05:00': {'1. open': '184.0000', '2. high': '184.4000', '3. low': '184.0000', '4. close': '184.4000', '5. volume': '9'}, '2024-02-26 17:00:00': {'1. open': '184.1300', '2. high': '184.4000', '3. low': '184.1300', '4. close': '184.4000', '5. volume': '5'}, '2024-02-26 16:55:00': {'1. open': '184.0000', '2. high': '184.0000', '3. low': '184.0000', '4. close': '184.0000', '5. volume': '361'}, '2024-02-26 16:50:00': {'1. open': '184.4000', '2. high': '184.4000', '3. low': '184.4000', '4. close': '184.4000', '5. volume': '1'}, '2024-02-26 16:45:00': {'1. open': '184.1000', '2. high': '184.3800', '3. low': '184.0000', '4. close': '184.3800', '5. volume': '77'}, '2024-02-26 16:25:00': {'1. open': '184.1400', '2. high': '184.1400', '3. low': '184.0300', '4. close': '184.1300', '5. volume': '383'}, '2024-02-26 16:20:00': {'1. open': '184.1100', '2. high': '184.4200', '3. low': '184.0000', '4. close': '184.0000', '5. volume': '84'}, '2024-02-26 16:15:00': {'1. open': '184.1300', '2. high': '184.4200', '3. low': '184.1300', '4. close': '184.4200', '5. volume': '127'}, '2024-02-26 16:10:00': {'1. open': '184.1300', '2. high': '184.2100', '3. low': '184.0000', '4. close': '184.0000', '5. volume': '1073859'}, '2024-02-26 16:05:00': {'1. open': '184.2100', '2. high': '184.6900', '3. low': '184.1200', '4. close': '184.6900', '5. volume': '30'}, '2024-02-26 16:00:00': {'1. open': '184.1000', '2. high': '184.8900', '3. low': '184.0900', '4. close': '184.8900', '5. volume': '2984418'}, '2024-02-26 15:55:00': {'1. open': '184.5100', '2. high': '184.5200', '3. low': '184.0600', '4. close': '184.1000', '5. volume': '309483'}, '2024-02-26 15:50:00': {'1. open': '184.9300', '2. high': '184.9900', '3. low': '184.3900', '4. close': '184.5000', '5. volume': '154618'}, '2024-02-26 15:45:00': {'1. open': '184.9300', '2. high': '185.0000', '3. low': '184.8600', '4. close': '184.8900', '5. volume': '77930'}, '2024-02-26 15:40:00': {'1. open': '184.8740', '2. high': '184.9600', '3. low': '184.8500', '4. close': '184.9500', '5. volume': '50685'}, '2024-02-26 15:35:00': {'1. open': '184.9200', '2. high': '184.9500', '3. low': '184.7600', '4. close': '184.8800', '5. volume': '42473'}, '2024-02-26 15:30:00': {'1. open': '185.2400', '2. high': '185.2600', '3. low': '184.8300', '4. close': '184.9450', '5. volume': '44399'}, '2024-02-26 15:25:00': {'1. open': '185.2000', '2. high': '185.2240', '3. low': '185.0800', '4. close': '185.2000', '5. volume': '25124'}, '2024-02-26 15:20:00': {'1. open': '185.1400', '2. high': '185.2300', '3. low': '185.0800', '4. close': '185.2150', '5. volume': '29912'}, '2024-02-26 15:15:00': {'1. open': '185.2900', '2. high': '185.2900', '3. low': '185.0700', '4. close': '185.1300', '5. volume': '31092'}, '2024-02-26 15:10:00': {'1. open': '185.3600', '2. high': '185.4250', '3. low': '185.2900', '4. close': '185.3050', '5. volume': '35188'}, '2024-02-26 15:05:00': {'1. open': '185.4800', '2. high': '185.5200', '3. low': '185.3200', '4. close': '185.3400', '5. volume': '23385'}, '2024-02-26 15:00:00': {'1. open': '185.4700', '2. high': '185.5200', '3. low': '185.3700', '4. close': '185.4550', '5. volume': '25035'}, '2024-02-26 14:55:00': {'1. open': '185.5200', '2. high': '185.5960', '3. low': '185.4800', '4. close': '185.4800', '5. volume': '20905'}, '2024-02-26 14:50:00': {'1. open': '185.6000', '2. high': '185.7100', '3. low': '185.5300', '4. close': '185.5400', '5. volume': '27967'}, '2024-02-26 14:45:00': {'1. open': '185.5850', '2. high': '185.6700', '3. low': '185.5500', '4. close': '185.6000', '5. volume': '21051'}, '2024-02-26 14:40:00': {'1. open': '185.6480', '2. high': '185.6600', '3. low': '185.4800', '4. close': '185.5800', '5. volume': '16695'}, '2024-02-26 14:35:00': {'1. open': '185.6700', '2. high': '185.6900', '3. low': '185.5700', '4. close': '185.6350', '5. volume': '24329'}, '2024-02-26 14:30:00': {'1. open': '185.7500', '2. high': '185.7900', '3. low': '185.6320', '4. close': '185.6650', '5. volume': '19252'}, '2024-02-26 14:25:00': {'1. open': '185.8300', '2. high': '185.8300', '3. low': '185.7050', '4. close': '185.7650', '5. volume': '14732'}, '2024-02-26 14:20:00': {'1. open': '185.7300', '2. high': '185.7900', '3. low': '185.6800', '4. close': '185.7900', '5. volume': '17479'}, '2024-02-26 14:15:00': {'1. open': '185.6500', '2. high': '185.7300', '3. low': '185.5800', '4. close': '185.7300', '5. volume': '74627'}, '2024-02-26 14:10:00': {'1. open': '185.6950', '2. high': '185.7500', '3. low': '185.5700', '4. close': '185.6370', '5. volume': '27114'}, '2024-02-26 14:05:00': {'1. open': '185.7500', '2. high': '185.8600', '3. low': '185.6900', '4. close': '185.6900', '5. volume': '27111'}, '2024-02-26 14:00:00': {'1. open': '185.6400', '2. high': '185.8100', '3. low': '185.6300', '4. close': '185.7500', '5. volume': '37493'}, '2024-02-26 13:55:00': {'1. open': '185.6600', '2. high': '185.6700', '3. low': '185.5500', '4. close': '185.6300', '5. volume': '16925'}, '2024-02-26 13:50:00': {'1. open': '185.5600', '2. high': '185.7000', '3. low': '185.4900', '4. close': '185.6600', '5. volume': '24066'}, '2024-02-26 13:45:00': {'1. open': '185.6400', '2. high': '185.7300', '3. low': '185.5200', '4. close': '185.5500', '5. volume': '17696'}, '2024-02-26 13:40:00': {'1. open': '185.4950', '2. high': '185.6800', '3. low': '185.4900', '4. close': '185.6350', '5. volume': '26052'}, '2024-02-26 13:35:00': {'1. open': '185.2800', '2. high': '185.5000', '3. low': '185.2000', '4. close': '185.4950', '5. volume': '25470'}, '2024-02-26 13:30:00': {'1. open': '185.3500', '2. high': '185.4200', '3. low': '185.2300', '4. close': '185.2700', '5. volume': '33053'}, '2024-02-26 13:25:00': {'1. open': '185.4150', '2. high': '185.4200', '3. low': '185.2450', '4. close': '185.3500', '5. volume': '28068'}, '2024-02-26 13:20:00': {'1. open': '185.2800', '2. high': '185.4200', '3. low': '185.2200', '4. close': '185.4120', '5. volume': '26085'}, '2024-02-26 13:15:00': {'1. open': '185.3200', '2. high': '185.3950', '3. low': '185.2700', '4. close': '185.2800', '5. volume': '37133'}, '2024-02-26 13:10:00': {'1. open': '185.2650', '2. high': '185.3000', '3. low': '185.1800', '4. close': '185.3000', '5. volume': '21574'}, '2024-02-26 13:05:00': {'1. open': '185.1600', '2. high': '185.2700', '3. low': '185.1520', '4. close': '185.2650', '5. volume': '20449'}, '2024-02-26 13:00:00': {'1. open': '185.2200', '2. high': '185.2700', '3. low': '185.1100', '4. close': '185.1550', '5. volume': '19945'}, '2024-02-26 12:55:00': {'1. open': '185.1600', '2. high': '185.2600', '3. low': '185.1300', '4. close': '185.2300', '5. volume': '20652'}, '2024-02-26 12:50:00': {'1. open': '185.0600', '2. high': '185.1700', '3. low': '185.0600', '4. close': '185.1450', '5. volume': '19451'}, '2024-02-26 12:45:00': {'1. open': '185.1700', '2. high': '185.2000', '3. low': '185.0300', '4. close': '185.0650', '5. volume': '17771'}, '2024-02-26 12:40:00': {'1. open': '185.1500', '2. high': '185.2600', '3. low': '185.1300', '4. close': '185.1500', '5. volume': '17328'}, '2024-02-26 12:35:00': {'1. open': '185.2050', '2. high': '185.2500', '3. low': '185.0800', '4. close': '185.1650', '5. volume': '18695'}, '2024-02-26 12:30:00': {'1. open': '185.1100', '2. high': '185.2700', '3. low': '185.0800', '4. close': '185.1950', '5. volume': '27493'}, '2024-02-26 12:25:00': {'1. open': '185.2200', '2. high': '185.3000', '3. low': '185.0400', '4. close': '185.1350', '5. volume': '26508'}, '2024-02-26 12:20:00': {'1. open': '184.9480', '2. high': '185.2300', '3. low': '184.9400', '4. close': '185.2300', '5. volume': '27245'}, '2024-02-26 12:15:00': {'1. open': '185.1300', '2. high': '185.1400', '3. low': '184.9550', '4. close': '184.9600', '5. volume': '22593'}, '2024-02-26 12:10:00': {'1. open': '184.8400', '2. high': '185.1400', '3. low': '184.8400', '4. close': '185.0990', '5. volume': '25650'}, '2024-02-26 12:05:00': {'1. open': '184.8100', '2. high': '184.8950', '3. low': '184.7200', '4. close': '184.8650', '5. volume': '21277'}, '2024-02-26 12:00:00': {'1. open': '184.9400', '2. high': '184.9800', '3. low': '184.7900', '4. close': '184.8140', '5. volume': '31894'}, '2024-02-26 11:55:00': {'1. open': '185.0200', '2. high': '185.0300', '3. low': '184.7900', '4. close': '184.9500', '5. volume': '23700'}, '2024-02-26 11:50:00': {'1. open': '185.1600', '2. high': '185.2200', '3. low': '184.9750', '4. close': '185.0320', '5. volume': '20835'}, '2024-02-26 11:45:00': {'1. open': '185.0400', '2. high': '185.1600', '3. low': '185.0200', '4. close': '185.1500', '5. volume': '23368'}, '2024-02-26 11:40:00': {'1. open': '184.8910', '2. high': '185.0500', '3. low': '184.8800', '4. close': '185.0400', '5. volume': '45407'}, '2024-02-26 11:35:00': {'1. open': '184.7300', '2. high': '184.8750', '3. low': '184.6300', '4. close': '184.8700', '5. volume': '38828'}, '2024-02-26 11:30:00': {'1. open': '184.7000', '2. high': '184.8600', '3. low': '184.6700', '4. close': '184.7300', '5. volume': '24056'}, '2024-02-26 11:25:00': {'1. open': '184.7900', '2. high': '184.7900', '3. low': '184.6100', '4. close': '184.6600', '5. volume': '25430'}, '2024-02-26 11:20:00': {'1. open': '184.6750', '2. high': '184.9400', '3. low': '184.6600', '4. close': '184.8100', '5. volume': '21756'}, '2024-02-26 11:15:00': {'1. open': '184.6200', '2. high': '184.7800', '3. low': '184.6000', '4. close': '184.6750', '5. volume': '17794'}, '2024-02-26 11:10:00': {'1. open': '184.8000', '2. high': '184.8100', '3. low': '184.5300', '4. close': '184.6400', '5. volume': '25842'}, '2024-02-26 11:05:00': {'1. open': '184.7400', '2. high': '184.8500', '3. low': '184.6110', '4. close': '184.7820', '5. volume': '27764'}, '2024-02-26 11:00:00': {'1. open': '184.8900', '2. high': '184.9800', '3. low': '184.7000', '4. close': '184.7520', '5. volume': '16468'}, '2024-02-26 10:55:00': {'1. open': '185.0600', '2. high': '185.0600', '3. low': '184.8100', '4. close': '184.8500', '5. volume': '38065'}, '2024-02-26 10:50:00': {'1. open': '184.6800', '2. high': '185.1100', '3. low': '184.6800', '4. close': '185.0200', '5. volume': '29462'}, '2024-02-26 10:45:00': {'1. open': '184.5400', '2. high': '184.9130', '3. low': '184.5100', '4. close': '184.7300', '5. volume': '18658'}, '2024-02-26 10:40:00': {'1. open': '184.4700', '2. high': '184.6760', '3. low': '184.4390', '4. close': '184.5400', '5. volume': '25891'}}}


        json_data = {
            "symbol": stock_code,
            "stock_key": stock_key,
            "stock_data": stock_data
        }

        requests.post(
            'https://webhook.site/3a34eeab-2ec7-4f8c-8480-fa477c50d91e',
            json=json_data
        )

        return HttpResponse()

    def get_stocks(self, request: HttpRequest) -> None:
        '''
            receive and response all requests of stocks
        '''
        stock_code = request.GET.get('stock_code')

        print(f'The stock code is {stock_code}')

        stock_dto = self.stock_controller.get_stock_information(stock_code=stock_code.upper()) 

        return JsonResponse(stock_dto.__dict__)
